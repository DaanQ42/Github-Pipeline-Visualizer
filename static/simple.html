<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Sample Site</title>
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
      integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"
      crossorigin="anonymous"
    />
    <style>
      body {
        padding-top: 50px;
      }
      ,
      .success: {
        background: green;
        transition: background 2s;
      }
      ,
      .queued: {
        background: gray;
        transition: background 2s;
      }
      ,
      .in_progress: {
        background: yellow;
        transition: background 2s;
      }
      ,
      .completed: {
        background: green;
        transition: background 2s;
      }
    </style>
  </head>

  <body>
    <h1 id="status"></h1>
    <div id="container"></div>
    <script type="module">
      function get_job(job_id) {
        const job = document.getElementById(`job-${job_id}`);
        if (job) {
          return job;
        }

        const container = document.getElementById("container");
        const new_job = document.createElement("div");
        container.appendChild(new_job);
        new_job.id = `job-${job_id}`;
        return new_job;
      }

      import { EventConnection } from "./scripts/modules/websocket.mjs";
      const host = window.location.host;
      const events = new EventConnection(`ws://${host}/websockets`);

      events.on_connection_state((state) => {
        document.getElementById("status").innerHTML = `Status: ${state}`;
      });
      events.workflow_update((workflow_update) => {
        const job = get_job(workflow_update.id);
        job.className = `workflow ${workflow_update.conclusion ?? ""} ${workflow_update.status ?? ""}`;
        job.innerHTML = `
          <h2>${workflow_update.name}</h2>
          <p>${workflow_update.conclusion ?? ""}</p>
        `;
      });
    </script>
  </body>
</html>
